<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>skarja.la</title>
        <link rel="stylesheet" href="styles.css" />
        <script src="webgl.js" type="module"></script>
    </head>
    <body>
        <!-- <div class="frontpage-container">
            skarjala
        </div> -->
        <canvas id="glcanvas" width="320" height="320"></canvas>
    </body>
    <script id="vertex" type="x-shader/x-vertex">
        attribute vec4 a_position;
        attribute vec4 a_color;
        
        uniform mat4 u_matrix;
        
        varying vec4 v_color;
        
        uniform float u_time;
        uniform float u_side_length;
        attribute vec4 a_offset;
        
        mat4 make_translation(in vec3 offset) {
            return mat4(
                1, 0, 0, 0,
                0, 1, 0, 0,
                0, 0, 1, 0,
                offset.x, offset.y, offset.z, 1
            );
        }
        
        mat4 make_x_rotation(in float angle_rad) {
            float cos_angle = cos(angle_rad);
            float sin_angle = sin(angle_rad);
        
            return mat4(
                1, 0,         0,         0,
                0, cos_angle, sin_angle, 0,
                0,-sin_angle, cos_angle, 0,
                0, 0,         0,         1
            );
        }
        
        mat4 make_y_rotation(in float angle_rad) {
            float cos_angle = cos(angle_rad);
            float sin_angle = sin(angle_rad);
        
            return mat4(
                cos_angle, 0,-sin_angle, 0,
                0,         1, 0,         0,
                sin_angle, 0, cos_angle, 0,
                0,         0, 0,         1
            );
        }
        
        mat4 make_z_rotation(in float angle_rad) {
            float cos_angle = cos(angle_rad);
            float sin_angle = sin(angle_rad);
        
            return mat4(
                    cos_angle, sin_angle, 0, 0,
                -sin_angle, cos_angle, 0, 0,
                0,          0,         1, 0,
                0,          0,         0, 1
            );
        }
        
        mat4 make_projection(in float width, in float height, in float depth) {
            return mat4(
                2.0 / width, 0, 0, 0,
                0, -2.0 / height, 0, 0,
                0, 0, 2.0 / depth, 0,
                -1, 1, 0, 1
            );
        }
        
        void main() {
            float dist = length(a_offset * 100.0);
            mat4 transformation = u_matrix * make_translation(a_offset.xyz * 2.0*u_side_length) * make_y_rotation(u_time + dist * 0.01) * make_translation(-a_offset.xyz * 2.0*u_side_length);
            gl_Position = transformation * a_position;
            v_color = a_color;
        }
    </script>
    
    <script id="fragment" type="x-shader/x-fragment">
        precision mediump float;
        
        // Passed in from the vertex shader.
        varying vec4 v_color;
        
        void main() {
           gl_FragColor = v_color;
        }
    </script>
</html>
